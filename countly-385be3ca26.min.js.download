!function(e){function n(){if(T){var n={name:T,segment:f};e.add_event({key:"[CLY]_view",dur:a()-N,segmentation:n}),T=null}}function t(n){if(!Y)if(e.app_key&&e.device_id){n.app_key=e.app_key,n.device_id=e.device_id,n.sdk_name=y,n.sdk_version=p,e.country_code&&(n.country_code=e.country_code),e.city&&(n.city=e.city),null!==e.ip_address&&(n.ip_address=e.ip_address),n.timestamp=s();var t=new Date;n.hour=t.getHours(),n.dow=t.getDay(),x.length>w&&x.shift(),x.push(n),W("cly_queue",x,!0)}else r("app_key or device_id is missing")}function i(){if("undefined"!=typeof e.q&&0<e.q.length){for(var n,o=0;o<e.q.length;o++)if(n=e.q[o],r("Processing queued call",n),"function"==typeof n)n();else if(n.constructor===Array&&0<n.length)if("undefined"!=typeof e[n[0]])e[n[0]].apply(null,n.slice(1));else{var s=n[0].replace("userData.","");"undefined"!=typeof e.userData[s]&&e.userData[s].apply(null,n.slice(1))}e.q=[]}if(_&&S&&F&&(n=a(),n-l>B&&(e.session_duration(n-l),l=n)),0<b.length&&(b.length<=I?(t({events:JSON.stringify(b)}),b=[]):(n=b.splice(0,I),t({events:JSON.stringify(n)})),W("cly_event",b)),0<x.length&&j&&a()>q){j=!1;var d=x.shift();r("Processing request",d);var c=function(e,n){r("Request Finished",n,e),e&&(x.unshift(n),q=a()+A),W("cly_queue",x,!0),j=!0};try{r("Sending XML HTTP request");var u,f=window.XMLHttpRequest?new window.XMLHttpRequest:window.ActiveXObject?new ActiveXObject("Microsoft.XMLHTTP"):null;n=[];for(var m in d)n.push(m+"="+encodeURIComponent(d[m]));u=n.join("&"),m="GET",2e3<=u.length?m="POST":e.force_post&&(m="POST"),"GET"===m?f.open("GET",e.url+h+"?"+u,!0):(f.open("POST",e.url+h,!0),f.setRequestHeader("Content-type","application/x-www-form-urlencoded")),f.onreadystatechange=function(){4===this.readyState&&200<=this.status&&300>this.status?"function"==typeof c&&c(!1,d):4===this.readyState&&(r("Failed Server XML HTTP request",this.status),"function"==typeof c&&c(!0,d))},"GET"==m?f.send():f.send(u)}catch(p){r("Failed XML HTTP request",p),"function"==typeof c&&c(!0,d)}}setTimeout(i,v)}function o(){var n={};if(n._app_version=e.app_version,n._ua=navigator.userAgent,screen.width){var t=screen.width?parseInt(screen.width):0,i=screen.height?parseInt(screen.height):0;if(0!==t&&0!==i){if(navigator.platform&&/iPad|iPhone|iPod/.test(navigator.platform)&&window.devicePixelRatio)t=Math.round(t*window.devicePixelRatio),i=Math.round(i*window.devicePixelRatio);else if(90===Math.abs(window.orientation))var o=t,t=i,i=o;n._resolution=""+t+"x"+i}}if(window.devicePixelRatio&&(n._density=window.devicePixelRatio),t=navigator.language||navigator.browserLanguage||navigator.systemLanguage||navigator.userLanguage,"undefined"!=typeof t&&(n._locale=t),"undefined"!=typeof document.referrer&&document.referrer.length&&(t=D.exec(document.referrer))&&t[11]&&t[11]!=window.location.hostname){if(t=!1,C&&C.length)for(i=0;i<C.length;i++)try{if(RegExp(C[i]).test(document.referrer)){r("Ignored:",document.referrer),t=!0;break}}catch(a){}t||(n._store=document.referrer)}return r("Got metrics",n),n}function r(){e.debug&&"undefined"!=typeof console&&(arguments[1]&&"object"==typeof arguments[1]&&(arguments[1]=JSON.stringify(arguments[1])),console.log(Array.prototype.slice.call(arguments).join("\n")))}function a(){return Math.floor((new Date).getTime()/1e3)}function s(){var e=(new Date).getTime();return X>=e?X++:X=e,X}function d(e,n,i){if(e){var i=i||O,r="";"object"==typeof e?"undefined"!=typeof e.stack?r=e.stack:("undefined"!=typeof e.name&&(r+=e.name+":"),"undefined"!=typeof e.message&&(r+=e.message+"\n"),"undefined"!=typeof e.fileName&&(r+="in "+e.fileName+"\n"),"undefined"!=typeof e.lineNumber&&(r+="on "+e.lineNumber),"undefined"!=typeof e.columnNumber&&(r+=":"+e.columnNumber)):r=e+"",n=!!n,e=o(),r={_resolution:e._resolution,_error:r,_app_version:e._app_version,_run:a()-m,_not_os_specific:!0},(e=navigator.battery||navigator.webkitBattery||navigator.mozBattery||navigator.msBattery)&&(r._bat=Math.floor(100*e.level)),"undefined"!=typeof navigator.onLine&&(r._online=!!navigator.onLine),r._background=!document.hasFocus(),0<k.length&&(r._logs=k.join("\n")),k=[],r._nonfatal=n,r._view=(window.location.pathname||"")+(window.location.search||"")+(window.location.hash||""),"undefined"!=typeof i&&(r._custom=i);try{var s=document.createElement("canvas").getContext("experimental-webgl");r._opengl=s.getParameter(s.VERSION)}catch(d){}t({crash:JSON.stringify(r)})}}function c(e,n){for(var t,i={},o=0;o<n.length;o++)t=n[o],"undefined"!=typeof e[t]&&(i[t]=e[t]);return i}function u(e){return"undefined"==typeof e.pageY&&"number"==typeof e.clientX&&document.documentElement&&(e.pageX=e.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,e.pageY=e.clientY+document.body.scrollTop+document.documentElement.scrollTop),e}var l,f,m,p="16.12",y="javascript_native_web",g=!1,_=!1,h="/i",v=500,w=1e3,x=[],b=[],k=[],L={},C=[],O=null,S=!0,E=0,T=null,N=0,M=0,q=0,A=60,P=20,H=0,B=60,I=10,X=0,j=!0,D=/^(((([^:\/#\?]+:)?(?:(\/\/)((?:(([^:@\/#\?]+)(?:\:([^:@\/#\?]+))?)@)?(([^:\/#\?\]\[]+|\[[^\/\]@#?]+\])(?:\:([0-9]+))?))?)?)?((\/?(?:[^\/\?#]+\/+)*)([^\?#]*)))?(\?[^#]+)?)(#.*)?/,R=/(nuhk|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask Jeeves\/Teoma|ia_archiver|bingbot|Google Web Preview|Mediapartners-Google|AdsBot-Google|Baiduspider|Ezooms|YahooSeeker|AltaVista|AVSearch|Mercator|Scooter|InfoSeek|Ultraseek|Lycos|Wget|YandexBot|Yandex|YaDirectFetcher|SiteBot|Exabot|AhrefsBot|MJ12bot|TurnitinBot|magpie-crawler|Nutch Crawler|CMS Crawler|rogerbot|Domnutch|ssearch_bot|XoviBot|netseer|digincore|fr-crawler|wesee|AliasIO)/,Y=!1,F=!0;e.init=function(n){if(!g){m=a(),g=!0,x=W("cly_queue")||[],L={},b=W("cly_event")||[],n=n||{},v=n.interval||e.interval||v,w=n.queue_size||e.queue_size||w,A=n.fail_timeout||e.fail_timeout||A,P=n.inactivity_time||e.inactivity_time||P,B=n.session_update||e.session_update||B,I=n.max_events||e.max_events||I,e.ignore_prefetch=n.ignore_prefetch||e.ignore_prefetch||!0,e.debug=n.debug||e.debug||!1,e.app_key=n.app_key||e.app_key||null;var t,o=e;if(!(t=n.device_id)&&!(t=e.device_id)&&!(t=W("cly_id"))){var s=(new Date).getTime();t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var n=(s+16*Math.random())%16|0;return s=Math.floor(s/16),("x"==e?n:3&n|8).toString(16)})}if(o.device_id=t,o=e,t=n.url||e.url||"",t="/"==t.substr(t.length-1)?t.substr(0,t.length-1):t,o.url=t,e.app_version=n.app_version||e.app_version||"0.0",e.country_code=n.country_code||e.country_code||null,e.city=n.city||e.city||null,e.ip_address=n.ip_address||e.ip_address||null,e.ignore_bots=n.ignore_bots||e.ignore_bots||!0,e.force_post=n.force_post||e.force_post||!1,e.q=e.q||[],n.ignore_referrers&&n.ignore_referrers.constructor===Array?C=n.ignore_referrers:e.ignore_referrers&&e.ignore_referrers.constructor===Array&&(C=e.ignore_referrers),""===e.url&&(r("Please provide server URL"),Y=!0),e.ignore_prefetch&&"undefined"!=typeof document.visibilityState&&"prerender"===document.visibilityState&&(Y=!0),e.ignore_bots&&R.test(navigator.userAgent)&&(Y=!0),!Y&&(r("Countly initialized"),e.q.constructor!==Array&&(e.q=[]),i(),W("cly_id",e.device_id),location.search))for(n=location.search.substring(1).split("&"),o=0;o<n.length;o++)t=n[o].split("="),"cly_id"==t[0]?W("cly_cmp_id",t[1]):"cly_uid"==t[0]&&W("cly_cmp_uid",t[1])}},e.begin_session=function(e){_||(r("Session started"),l=a(),_=!0,S=!e,e={begin_session:1},e.metrics=JSON.stringify(o()),t(e))},e.session_duration=function(e){_&&(r("Session extended",e),t({session_duration:e}))},e.end_session=function(e){_&&(e=e||a()-l,r("Ending session"),n(),_=!1,t({end_session:1,session_duration:e}),i())},e.change_id=function(n,i){if(e.device_id!=n){i||(e.end_session(),L={});var o=e.device_id;e.device_id=n,W("cly_id",e.device_id),r("Changing id"),i?t({old_device_id:o}):e.begin_session(!S)}},e.add_event=function(e){if(e.key){e.count||(e.count=1);var n=c(e,["key","count","sum","dur","segmentation"]);n.timestamp=s();var t=new Date;n.hour=t.getHours(),n.dow=t.getDay(),b.push(n),W("cly_event",b),r("Adding event: ",e)}else r("Event must have key property")},e.start_event=function(e){L[e]?r("Timed event with key "+e+" already started"):L[e]=a()},e.end_event=function(n){"string"==typeof n&&(n={key:n}),n.key?L[n.key]?(n.dur=a()-L[n.key],e.add_event(n),delete L[n.key]):r("Timed event with key "+n.key+" was not started"):r("Event must have key property")},e.user_details=function(e){r("Adding userdetails: ",e),t({user_details:JSON.stringify(c(e,"name username email organization phone picture gender byear custom".split(" ")))})},e.report_conversion=function(e,n){e=e||W("cly_cmp_id")||"cly_organic",n=n||W("cly_cmp_uid"),e&&n?t({campaign_id:e,campaign_user:n}):e?t({campaign_id:e}):r("No campaign data found")};var $={},z=function(e,n,t){$[e]||($[e]={}),"$push"==t||"$pull"==t||"$addToSet"==t?($[e][t]||($[e][t]=[]),$[e][t].push(n)):$[e][t]=n};e.userData={set:function(e,n){$[e]=n},set_once:function(e){z(e,1,"$setOnce")},increment:function(e){z(e,1,"$inc")},increment_by:function(e,n){z(e,n,"$inc")},multiply:function(e,n){z(e,n,"$mul")},max:function(e,n){z(e,n,"$max")},min:function(e,n){z(e,n,"$min")},push:function(e,n){z(e,n,"$push")},push_unique:function(e,n){z(e,n,"$addToSet")},pull:function(e,n){z(e,n,"$pull")},save:function(){t({user_details:JSON.stringify({custom:$})}),$={}}},e.track_errors=function(e){O=e,window.onerror=function(e,n,t,i,o){if("undefined"!=typeof o)d(o,!1);else{var i=i||window.event&&window.event.errorCharacter,r="";"undefined"!=typeof e&&(r+=e+"\n"),"undefined"!=typeof n&&(r+="at "+n),"undefined"!=typeof t&&(r+=":"+t),"undefined"!=typeof i&&(r+=":"+i),r+="\n";try{for(var a=[],s=arguments.callee.caller;s;)a.push(s.name),s=s.caller;r+=a.join("\n")}catch(c){}d(r,!1)}}},e.log_error=function(e,n){d(e,!0,n)},e.add_log=function(e){k.push(e)},e.stop_time=function(){F&&(F=!1,E=a()-l,M=a()-N)},e.start_time=function(){F||(F=!0,l=a()-E,N=a()-M,M=0)},e.track_sessions=function(){function n(){document[i]?e.stop_time():e.start_time()}function t(){H>=P&&e.start_time(),H=0}e.begin_session(),e.start_time(),G(window,"beforeunload",function(){e.end_session()}),G(window,"unload",function(){e.end_session()});var i="hidden";i in document?document.addEventListener("visibilitychange",n):(i="mozHidden")in document?document.addEventListener("mozvisibilitychange",n):(i="webkitHidden")in document?document.addEventListener("webkitvisibilitychange",n):(i="msHidden")in document?document.addEventListener("msvisibilitychange",n):"onfocusin"in document?(G(window,"focusin",function(){e.start_time()}),G(window,"focusout",function(){e.stop_time()})):(G(window,"focus",function(){e.start_time()}),G(window,"blur",function(){e.stop_time()}),G(window,"pageshow",function(){e.start_time()}),G(window,"pagehide",function(){e.stop_time()})),G(window,"mousemove",t),G(window,"click",t),G(window,"keydown",t),G(window,"scroll",t),setInterval(function(){H++,H>=P&&e.stop_time()},6e4)},e.track_pageview=function(t,i){if(n(),t&&t.constructor===Array&&(i=t,t=null),t=t||window.location.pathname,i&&i.length)for(var o=0;o<i.length;o++)try{if(RegExp(i[o]).test(t))return void r("Ignored:",t)}catch(s){}if(T=t,N=a(),o={name:t,visit:1,domain:window.location.hostname},"undefined"!=typeof document.referrer&&document.referrer.length){var d=D.exec(document.referrer);d&&d[11]&&d[11]!=window.location.hostname&&(o.start=1)}e.add_event({key:"[CLY]_view",segmentation:o})},e.track_view=function(n,t){e.track_pageview(n,t)},e.track_clicks=function(n){var n=n||document,t=!0;G(n,"click",function(n){if(t){if(t=!1,u(n),"undefined"!=typeof n.pageX&&"undefined"!=typeof n.pageY){var i;i=document,i=Math.max(Math.max(i.body.scrollHeight,i.documentElement.scrollHeight),Math.max(i.body.offsetHeight,i.documentElement.offsetHeight),Math.max(i.body.clientHeight,i.documentElement.clientHeight));var o;o=document,o=Math.max(Math.max(o.body.scrollWidth,o.documentElement.scrollWidth),Math.max(o.body.offsetWidth,o.documentElement.offsetWidth),Math.max(o.body.clientWidth,o.documentElement.clientWidth)),e.add_event({key:"[CLY]_action",segmentation:{type:"click",x:n.pageX,y:n.pageY,width:o,height:i,domain:window.location.hostname}})}setTimeout(function(){t=!0},1e3)}})},e.track_links=function(n){n=n||document,G(n,"click",function(n){var t=J(n).closest("a");t&&(u(n),e.add_event({key:"linkClick",segmentation:{href:t.href,text:t.innerText,id:t.id,x:n.pageX,y:n.pageY}}),"undefined"!=typeof t.href&&"_blank"!==t.target&&!n.metaKey&&!n.altKey&&!n.ctrlKey&&!n.shiftKey&&0!==t.href.replace(window.location.href.split("#")[0],"").indexOf("#")&&e.end_session())})},e.track_forms=function(n){function t(e){return e.name||e.id||e.type||e.nodeName}n=n||document,G(n,"submit",function(n){var i,n=J(n),o={id:n.id,name:n.name,action:n.action,method:n.method};if("undefined"!=typeof n.elements)for(var r=0;r<n.elements.length;r++)if((i=n.elements[r])&&"password"!=i.type)if("undefined"==typeof o["input:"+t(i)]&&(o["input:"+t(i)]=[]),"select"==i.nodeName.toLowerCase())if("undefined"!=typeof i.multiple){var a=[];if("undefined"!=typeof i.options)for(var s=0;s<i.options.length;s++)i.options[s].selected&&a.push(i.options[s].value);o["input:"+t(i)].push(a.join(", "))}else o["input:"+t(i)].push(i.options[i.selectedIndex].value);else"input"==i.nodeName.toLowerCase()?"undefined"!=typeof i.type&&("checkbox"==i.type.toLowerCase()||"radio"==i.type.toLowerCase())?i.checked&&o["input:"+t(i)].push(i.value):o["input:"+t(i)].push(i.value):"textarea"==i.nodeName.toLowerCase()?o["input:"+t(i)].push(i.value):"undefined"!=typeof i.value&&o["input:"+t(i)].push(i.value);for(var d in o)"undefined"!=typeof o[d].join&&(o[d]=o[d].join(", "));e.add_event({key:"formSubmit",segmentation:o}),e.end_session()})},e.collect_from_forms=function(n,t){n=n||document,G(n,"submit",function(i){var o,i=J(i),a={},s=!1;if("undefined"!=typeof i.elements){var d,c={},u=n.getElementsByTagName("LABEL");for(d=0;d<u.length;d++)u[d].htmlFor&&""!==u[d].htmlFor&&(c[u[d].htmlFor]=u[d].innerText||u[d].textContent||u[d].innerHTML);for(d=0;d<i.elements.length;d++)if((o=i.elements[d])&&"password"!=o.type&&-1==o.className.indexOf("cly_user_ignore")){var l="";if("select"==o.nodeName.toLowerCase())if("undefined"!=typeof o.multiple){if(l=[],"undefined"!=typeof o.options)for(u=0;u<o.options.length;u++)o.options[u].selected&&l.push(o.options[u].value);l=l.join(", ")}else l=o.options[o.selectedIndex].value;else"input"==o.nodeName.toLowerCase()?"undefined"!=typeof o.type&&("checkbox"==o.type.toLowerCase()||"radio"==o.type.toLowerCase())?o.checked&&(l=o.value):l=o.value:"textarea"==o.nodeName.toLowerCase()?l=o.value:"undefined"!=typeof o.value&&(l=o.value);if(o.className&&-1!=o.className.indexOf("cly_user_")){for(o=o.className.split(" "),u=0;u<o.length;u++)if(0===o[u].indexOf("cly_user_")){a[o[u].replace("cly_user_","")]=l,s=!0;break}}else o.type&&"email"==o.type.toLowerCase()||o.name&&-1!=o.name.toLowerCase().indexOf("email")||o.id&&-1!=o.id.toLowerCase().indexOf("email")||o.id&&c[o.id]&&-1!=c[o.id].toLowerCase().indexOf("email")||/[^@\s]+@[^@\s]+\.[^@\s]+/.test(l)?(a.email||(a.email=l),s=!0):o.name&&-1!=o.name.toLowerCase().indexOf("username")||o.id&&-1!=o.id.toLowerCase().indexOf("username")||o.id&&c[o.id]&&-1!=c[o.id].toLowerCase().indexOf("username")?(a.username||(a.username=l),s=!0):o.name&&(-1!=o.name.toLowerCase().indexOf("tel")||-1!=o.name.toLowerCase().indexOf("phone")||-1!=o.name.toLowerCase().indexOf("number"))||o.id&&(-1!=o.id.toLowerCase().indexOf("tel")||-1!=o.id.toLowerCase().indexOf("phone")||-1!=o.id.toLowerCase().indexOf("number"))||o.id&&c[o.id]&&(-1!=c[o.id].toLowerCase().indexOf("tel")||-1!=c[o.id].toLowerCase().indexOf("phone")||-1!=c[o.id].toLowerCase().indexOf("number"))?(a.phone||(a.phone=l),s=!0):o.name&&(-1!=o.name.toLowerCase().indexOf("org")||-1!=o.name.toLowerCase().indexOf("company"))||o.id&&(-1!=o.id.toLowerCase().indexOf("org")||-1!=o.id.toLowerCase().indexOf("company"))||o.id&&c[o.id]&&(-1!=c[o.id].toLowerCase().indexOf("org")||-1!=c[o.id].toLowerCase().indexOf("company"))?(a.organization||(a.organization=l),s=!0):(o.name&&-1!=o.name.toLowerCase().indexOf("name")||o.id&&-1!=o.id.toLowerCase().indexOf("name")||o.id&&c[o.id]&&-1!=c[o.id].toLowerCase().indexOf("name"))&&(a.name||(a.name=""),a.name+=l+" ",s=!0)}}s&&(r("Gathered user data",a),t?e.user_details({custom:a}):e.user_details(a)),e.end_session()})},e.collect_from_facebook=function(n){FB&&FB.api&&FB.api("/me",function(t){var i={};if(t.name&&(i.name=t.name),t.email&&(i.email=t.email),"male"==t.gender?i.gender="M":"female"==t.gender&&(i.gender="F"),t.birthday){var o=t.birthday.split("/").pop();o&&4==o.length&&(i.byear=o)}if(t.work&&t.work[0]&&t.work[0].employer&&t.work[0].employer.name&&(i.organization=t.work[0].employer.name),n){i.custom={};for(var r in n){for(var o=n[r].split("."),a=t,s=0;s<o.length&&(a=a[o[s]],!("undefined"==typeof a));s++);"undefined"!=typeof a&&(i.custom[r]=a)}}e.user_details(i)})},Element.prototype.closest||(Element.prototype.closest=function(e){for(var n=this,e=e.toUpperCase();n;){if(n.nodeName.toUpperCase()==e)return n;n=n.parentElement}});var G=function(e,n,t){"undefined"!=typeof e.addEventListener?e.addEventListener(n,t,!1):e.attachEvent("on"+n,t)},J=function(e){return e?"undefined"!=typeof e.target?e.target:e.srcElement:window.event.srcElement},W=function(e,n,t){function i(e,n,t){var i=new Date;i.setTime(i.getTime()+864e5*t),t="; expires="+i.toGMTString(),document.cookie=e+"="+n+t+"; path=/"}var o,t=t||!1,r=!1;if("undefined"!=typeof localStorage){r=!0;try{localStorage.setItem("testLocal",!0)}catch(a){r=!1}}if("undefined"!=typeof n&&null!==n&&("object"==typeof n&&(n=JSON.stringify(n)),r?localStorage.setItem(e,n):t||i(e,n,30)),"undefined"==typeof n){if(r)o=localStorage.getItem(e);else if(!t)e:{for(e+="=",n=document.cookie.split(";"),t=0,r=n.length;t<r;t++){for(o=n[t];" "===o.charAt(0);)o=o.substring(1,o.length);if(0===o.indexOf(e)){o=o.substring(e.length,o.length);break e}}o=null}try{o=JSON.parse(o)}catch(s){}return o}null===n&&(r?localStorage.removeItem(e):t||i(e,"",-1))}}(window.Countly=window.Countly||{});